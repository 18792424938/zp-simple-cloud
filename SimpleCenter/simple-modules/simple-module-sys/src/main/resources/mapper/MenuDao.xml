<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zp.module.sys.dao.MenuDao">




    <select id="findByRoleId" parameterType="String" resultType="String">
        select
        sm.perms
        from sys.sys_role sr
        left join sys.sys_role_menu srm
        on sr.id = srm.role_id
        left join sys.sys_menu sm
        on srm.menu_id = sm.id
        where sr.id =  #{roleId,jdbcType=VARCHAR} and sm.perms is not null and sm.perms &lt;&gt; ''
    </select>


    <resultMap id="treeData" type="com.zp.api.sys.entity.MenuEntity">
        <id column="id" property="id"/>
        <result column="name" property="name"/>
        <result column="parent_id" property="parentId"/>
        <result column="perms" property="perms"/>
        <result column="route_name" property="routeName"/>
        <result column="system_id" property="systemId"/>
        <result column="type" property="type"/>
        <result column="order_num" property="orderNum"/>
        <result column="icon" property="icon"/>
        <result column="enabled" property="enabled"/>
        <result column="describe" property="describe"/>
        <result column="component_url" property="componentUrl"/>
        <result column="route_path" property="routePath"/>
        <collection property="children" select="treeChildren"  column="{pid=id}">
        </collection>
    </resultMap>


    <resultMap id="navData" type="com.zp.api.sys.entity.MenuEntity">
        <id column="id" property="id"/>
        <result column="name" property="name"/>
        <result column="parent_id" property="parentId"/>
        <result column="perms" property="perms"/>
        <result column="route_name" property="routeName"/>
        <result column="system_id" property="systemId"/>
        <result column="type" property="type"/>
        <result column="order_num" property="orderNum"/>
        <result column="icon" property="icon"/>
        <result column="enabled" property="enabled"/>
        <result column="describe" property="describe"/>
        <result column="component_url" property="componentUrl"/>
        <result column="route_path" property="routePath"/>
        <collection property="children" select="navChildren"  column="{pid=id}">
        </collection>
    </resultMap>

    <select id="tree"  resultMap="treeData">
        select
            *
        from sys.sys_menu
        <where>
            (parent_id is null or parent_id = '') and system_id = #{systemId,jdbcType=VARCHAR}
        </where>
        order by order_num,create_date
    </select>
    <select id="treeChildren"  resultMap="treeData">
        select
        *
        from sys.sys_menu
        <where>
            parent_id = #{pid,jdbcType=VARCHAR}
        </where>
        order by order_num
    </select>



    <select id="nav"  resultMap="navData">
        select
        *
        from sys.sys_menu
        <where>
            (parent_id is null or parent_id = '') and system_id = #{systemId,jdbcType=VARCHAR}
        </where>
        order by order_num
    </select>
    <select id="navChildren"  resultMap="navData">
        select
        *
        from sys.sys_menu
        <where>
            parent_id = #{pid,jdbcType=VARCHAR}
        </where>
        order by order_num,create_date
    </select>





</mapper>